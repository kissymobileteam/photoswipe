/*! photoswipe - v1.0 - 2013-05-29 7:09:07 PM
* Copyright (c) 2013 bachi; Licensed  */
KISSY.add("mobile/photoswipe/1.0/index",function(a,b,c,d){"use strict";function e(b,c){return this instanceof e?(this.con=a.one(b),e.superclass.constructor.call(this,c),this.init(),void 0):new e(b,c)}return e.ATTRS={id:{value:"PhotoSwip-"+a.now()},slideOptimize:{value:!0},overflow:{value:!1},zoom:{value:!1},page:{value:0},caches:{value:{}},data:{value:{items:[{pic:"",title:""},{pic:"",title:""}]}},nextAtlas:{value:!1},getNextAtlas:{value:function(){}},itemHtml:{value:['<div class="ps-pal ${placeholder}">','<div class="ps-pic-wrapper">','<img src="${pic}" class="ps-pic" />',"</div>",'	<!--img class="ps-loading" src="http://img03.taobaocdn.com/tps/i3/T1Ou9TXCFdXXaPT2Hb-24-24.gif" /-->',"</div>"].join("")},wrapperHtml:{value:['<div id="${id}">','	<div class="ps-con">',"		$${items}","	</div>","</div>"].join("")},loadMoreHtml:{value:['<div class="ps-loadmore ps-pal">','<div class="ps-loadmore-img">',"</div>","</div>"].join("")},conClass:{value:""}},a.extend(e,a.Base,{init:function(){var d=this;d.initParam(),d.createHtml(),d.slide=new b(d.id,{conClass:d.conClass,autoSlide:!1,effect:"hSlide",touchmove:!0,adaptive_fixed_width:!0,contentClass:"ps-con",speed:250,pannelClass:"ps-pal",animWrapperAutoHeightSetting:!1,webkitOptimize:!0,adaptive_width:function(){return a.DOM.viewportWidth()},adaptive_height:function(){return a.DOM.viewportHeight()}}),d.mask=c({opacity:.6}),d.bindEvent()},handleImgMarginTop:function(b){var c=this,d=b;d&&setTimeout(function(){c.overflow===!1&&(d.width()>a.DOM.viewportWidth()&&d.width(a.DOM.viewportWidth()),d.height()>a.DOM.viewportHeight()&&d.height(a.DOM.viewportHeight()));var b=d.height(),e=(a.DOM.viewportHeight()-b)/2;d.css({"margin-top":e+"px"})},100)},isVisiable:function(){var a=this;return"none"==a.con.css("display")?!1:!0},addData:function(b){var c=this;c.data.items=c.data.items.concat(b),c.set("data",c.data),a.each(b,function(a){c.slide.add(d(c.itemHtml,a))});var e=c.con.one(".ps-placeholder");e&&e.remove(),c.page++,c.set("page",c.page),c.isVisiable()&&c.resetImgAlign()},slipperFilter:function(){for(var b=this,c=b.slide.pannels,d=0;d<b.slide.length;d++){var e=a.one(c[d]);e.hasClass("ps-loadmore")||(0!=e.children().length&&b._rememberPannel(d),d<b.slide.currentTab-1||d>b.slide.currentTab+1?b._emptyPannel(d):b._recallPannel(d))}},_rememberPannel:function(b){var c=this,d=a.one(c.slide.pannels[b]);c.caches["c"+b]=d.html(),c.set("caches",c.caches)},_emptyPannel:function(b){var c=this,d=a.one(c.slide.pannels[b]);0!=d.children().length&&c._rememberPannel(b),d.empty()},_recallPannel:function(b){var c=this,d=a.one(c.slide.pannels[b]),e=c.caches["c"+b];e&&(d.html(e),c.slide.currentTab!==b&&c.handleImgMarginTop(d.one(".ps-pic")))},prev:function(a){var b=this;b.slide.previous.call(b.slide,a)},next:function(a){var b=this;b.slide.next.call(b.slide,a)},createHtml:function(){var b=this,c=d(b.itemHtml,{pic:"",placeholder:"ps-placeholder"}),e=d(b.wrapperHtml,{id:b.id,items:c});b.con=a.Node(e),b.con.css({display:"none",left:0,top:0,width:a.DOM.viewportWidth(),height:a.DOM.viewportHeight(),position:"fixed","z-index":10001}),a.one("body").append(b.con)},initParam:function(){var b=this;a.each(e.ATTRS,function(a,c){b[c]=b.get(c)})},show:function(b){var c=this;"block"!=c.con.css("display")&&(c.con.css({display:"block"}),a.isUndefined(b)||c.slide.go(b,!1),c.mask.addMask(),c.resetImgAlign(),"true"!==c.con.attr("data-ps")&&(c.bindExitEvent(),c.con.attr("data-ps","true")))},resetImgAlign:function(){var a=this;a.slide.con.all("img.ps-pic").each(function(b){"true"!=b.attr("data-cultop")&&(a.handleImgMarginTop(b),b.attr("data-cultop","true"))})},hide:function(){var a=this;a.con.css({display:"none"}),a.mask.removeMask()},bindExitEvent:function(){var b=this;b.slide.pannels.on("click",function(c){a.one(c.target).hasClass("ps-pic")||b.hide()})},bindEvent:function(){var b=this;b.slide.on("beforeSwitch",function(){if(!b.slide.is_last())for(var c=b.slide.currentTab;c<b.slide.length;c++){var d=a.one(b.slide.pannels[c]).one("img.ps-pic");d&&b.handleImgMarginTop(d)}return b.slide.currentTab==b.slide.length-2&&b.hasNextAtlas()?(b.fire("edgeSwipe",{page:b.page}),setTimeout(function(){b.hasNextAtlas()||b.next()},30),!1):void 0}),b.slideOptimize&&b.slide.on("afterSwitch",function(){b.slipperFilter()})},_detachEvent:function(){},hasNextAtlas:function(b){var c=this;return a.isUndefined(b)?c.nextAtlas:(c.set("nextAtlas",b),c.nextAtlas=b,c._replaceLoadMore(),void 0)},_replaceLoadMore:function(){var a=this,b=a.con.one(".ps-loadmore");a.hasNextAtlas()?b?a._moveLoadMore():(a.slide.add(a.loadMoreHtml),a.handleImgMarginTop(a.con.one(".ps-loadmore-img"))):b&&a.slide.remove(a.slide.currentTab)},_moveLoadMore:function(){var a=this,b=a.con.one(".ps-loadmore");b.css({visibility:"hidden"}),b.appendTo("body").appendTo(a.slide.animwrap),b.css({visibility:"visible"})},destory:function(){}}),e},{requires:["gallery/slide/1.1/","mobile/simple-mask/1.0/","gallery/juicer/1.3/","base","node"]});